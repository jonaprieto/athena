
\documentclass[../itp-2018.tex]{subfiles}
\begin{document}

% ===================================================================

\section{Proof-Reconstruction}
\label{sec:proof-reconstruction}

In this section, we describe our approach to reconstruct proofs from
\CPL derivations generated by \Metis. This reconstruction consists of
a translation from a source system to the target system. The system of
origin is the automatic theorem prover \Metis and the target system is
the proof-assistant \Agda. We choose \Agda but another proof-assistant
with the same support of type theory and inductive types could be used
(\eg \Coq).

\subsection{Workflow}
\label{ssec:workflow}

\input{sections/diagram.tex}
The overview of the proof-reconstruction is presented as a workflow
in Fig.~\ref{fig:proof-reconstruction-workflow} following the same
basis of the proposed workflow presented in~\cite{sultana2015}.

The process begins assuming that the user posses a \TPTP valid file that encodes
a \CPL conjecture. If this conjecture is a theorem, by means of \Metis, we
obtain a derivation in \TSTP format of a proof for this conjecture. Now, we use
the \Athena tool to generate the \Agda file that corresponds to the proof-term
for such \TSTP derivation. \Athena parses and prunes the proof-tree of the \TSTP
derivation by removing some redundancies and steps that do not contribute in the
proof. After this translation process, we end up with a proof-term  in the \Agda
file of the natural deduction proof. This \Agda file will make calls to theorems
and lemmas from the \Agda libraries, \texttt{agda-prop} (classical propositional
logic) and \texttt{agda-metis} (propositional reasoning for \Metis derivations).

Using \Agda as the proof-checker, we type-check the proof-terms of the \Agda
file previous generated. If this type-checking success, the \TSTP derivation
generated by \Metis will be \emph{correct} module the \Agda correctness and the
proposed formalisation. In such a case, \Agda will output an interface file.
Otherwise, \Agda will report where the type-checking fails, if it is the case,
the failure must be investigated by the user. The possible causes can be due to
many factors: \emph{completeness} issues in our \Agda libraries for the \Metis
reasoning, bugs in the translation by \Athena, bugs in \Agda, printing errors
of the \TSTP derivation by \Metis or soundness bugs in the \Metis
reasoning.

In the remainder part of this section, we present a formal description of
definitions and theorems necessary to reconstruct \Metis inference rules.
Through this description, we refer to the lines in the \Metis derivation
presented in Fig.~\ref{complete-metis-example} of the theorem in
\eqref{eq:complete-example-problem} to show examples of each rule.

% ...................................................................

\subsection{Reconstructing \Metis inference rules}
\label{ssec:emulating-inferences}

In this section, we reconstruct each \Metis inference rule from
Table~\ref{tab:agda-metis-table}.
We begin describing the reconstruction of the \strip inference rule
since this rule  is the only one that closely follows the \Metis
source code. To reconstruct the other rules, we follow a pattern showed
in Example~\ref{ex:inference-rule-pattern}.

\begin{notation}
  The function name written in \texttt{typewriter} font refers to a
  \Metis inference rule in the \TSTP derivations. The same function
  name written using
  \textsf{sans serif} font refers to our formalized version to
  reconstruct the rule and formally implemented in~\cite{AgdaMetis}.
  To increase the readability for functions and theorems, we use
  the convention \Source and \Target as synonyms of the \Prop
  type. The \Source type in the reconstructed rule definition refers
  to the argument in the \TSTP derivation, \ie the input formula of
  the inference rule. A formula of \Target type refers to the
  expected result of the rule found in the \TSTP derivation.
\end{notation}

\subfile{sections/proof-reconstruction/strip.tex}

Now, as we mention in the beginning of this section, to reconstruct
the \Metis inference rules, we use the following pattern in
the formalization.

\begin{myexamplenum}
\label{ex:inference-rule-pattern}
Let \texttt{metisRule} be a \Metis inference rule. To reconstruct
this rule, we define the function \fun{metisRule} in type theory
that follows the pattern:

\begin{equation*}
  \begin{aligned}
  &\hspace{.495mm}\fun{metisRule} : \Source → \Target → \Prop\\
  &\begin{array}{ll}
  \fun{metisRule}~φ~ψ\ &=
      \begin{cases}
      ψ, &\text{if the conclusion }ψ\text{ can be}\text{ derived by applying certain inference}\\
         &\text{rules to the premise }φ;\\
      φ, &\text{otherwise;}
      \end{cases}
  \end{array}
  \end{aligned}
\end{equation*}

To justify all transformations done by the \fun{metisRule} rule, we
prove its soundness with a theorem like the following:

\begin{equation*}
  \text{If }Γ ⊢ φ \text{ then }Γ ⊢ \fun{metisRule}~φ~ψ.
\end{equation*}

\end{myexamplenum}

The remainder of this section will be devoted to present a formal
description in type theory of remaining \Metis rules presented in
Table~\ref{tab:agda-metis-table} using the pattern presented in the
example above. We follow the same order to present the rules as the
table shows.

% ------------------------------------------------------------------
% Rules that follow the pattern:

\subfile{sections/proof-reconstruction/conjunct.tex}
\subfile{sections/proof-reconstruction/resolve.tex}
\subfile{sections/proof-reconstruction/canonicalize.tex}
\subfile{sections/proof-reconstruction/clausify.tex}
\subfile{sections/proof-reconstruction/simplify.tex}

% -------------------------------------------------------------------

We have finished the formalization of every inference rule in
a \Metis derivation, we are able to justify step-by-step any proof
for a problem in propositional logic.
For instance, we tested successfully the translation by \Athena
jointly with the \Agda formalizations of the rules mentioned above
with more than eighty representative theorems in propositional
logic. An interested reader can test the
problems~\cite{Prieto-Cubides2017} in the \Athena tool
repository~\cite{Athena}.

\end{document}
