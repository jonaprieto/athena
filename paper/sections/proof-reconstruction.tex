
\documentclass[../main.tex]{subfiles}
\begin{document}

% ===================================================================

\section{Proof-Reconstruction}
\label{sec:proof-reconstruction}

The proof-reconstruction approach proposed consists of a series of
steps similar to the workflow presented~\cite{sultana2015}.  This
process is a translation from a source system to a target system. In
our case, the system of origin, the automatic theorem prover, is
\Metis; the target system is a proof-assistant, \Agda. We choose
\Agda, but another proof-assistant with the same support of type
theory and inductive types could be used.

\subsection{Workflow}
\label{ssec:workflow}

\input{sections/diagram.tex}
%  (see a description of \Agda for its main features in
% Section~\ref{sec:implementation}).
The overview of the proof-reconstruction is presented in
Fig.~\ref{fig:proof-reconstruction-workflow}. The process begins with
a \TPTP file that encodes a problem in \CPL. We use this file as the
input of the \Metis prover. If the problem is a theorem, \Metis
generates a derivation of the proof in \TSTP format.

With the \TSTP derivation from Step~2, we process the derivation with the
\Athena translator tool.
\Athena parses the \TSTP format, analyzes the
derivation and generates a representation of the natural deduction
proof using a tree data structure (see the properties
of this tree in Section~\ref{ssec:metis-proofs}).
In the \Athena analysis, some unnecessary steps that introduce redundancies
and some unused input are removed from the proof-tree.
As result, we get from \Athena an \Agda file of the proof
with names of functions and theorems from
the \Agda libraries that accompany this article:
\texttt{agda-prop} and \texttt{agda-metis}.

Finally, we type-check the \Agda proof-term. If the type-checking
success, the \TSTP derivation generated by \Metis is correct
module \Agda and the proposed formalizations for the
propositional logic and for the \Metis reasoning.
In that case \Agda outputs an interface file.
Otherwise, when type-checking fails, the failure must be
investigated by the user looking at the error in the \TSTP derivation
by \Metis, in the translation by \Athena, in the \Agda formalizations
mentioned above or in the type-checker~\Agda.

In the remainder part of this section, a formal description using
type theory is presented to build definitions and theorems of
functions necessary to reconstruct \Metis inference rules.

% % ................................................

\subsection{Reconstructing \Metis inference rules}
\label{ssec:emulating-inferences}

In this section, we reconstruct each \Metis inference rule in
Table~\ref{tab:agda-metis-table} via a function and its respective
theorem. We present a pattern of the formal description for these
rules in Example~\ref{ex:inference-rule-pattern}.

\begin{notation}
  The function name written in \texttt{typewriter} font refers to a
  \Metis inference rule. The same function name written using
  \textsf{sans serif} font refers to our formalized version to
  reconstruct the rule and implemented in~\cite{AgdaMetis}. We use
  \Source and \Target as synonyms of the \Prop type to describe in the
  function types the role of the arguments.
\end{notation}

\begin{myexamplenum}
\label{ex:inference-rule-pattern}
Let \texttt{metisRule} be a \Metis inference rule. To reconstruct this rule,
we define the function \fun{metisRule} in type theory that follows the pattern:

\begin{equation*}
  \begin{aligned}
  &\hspace{.495mm}\fun{metisRule} : \Source → \Target → \Prop\\
  &\begin{array}{ll}
  \fun{metisRule}~φ~ψ\ &=
      \begin{cases}
      ψ, &\text{if the conclusion}ψ\text{ can be}\text{ derived by applying certain inference}\\
         &\text{rules to the premise }φ;\\
      φ, &\text{otherwise;}
      \end{cases}
  \end{array}
  \end{aligned}
\end{equation*}

To justify all transformations done by the \fun{metisRule} rule, we prove
its soundness with a theorem like the following:

\begin{equation*}
  \text{If }Γ ⊢ φ \text{ then }Γ ⊢ \fun{metisRule}~φ~ψ, \text{ where } ψ : \Target.
\end{equation*}

\end{myexamplenum}

The remainder of this section will be devoted to present a formal
description in type theory of each rule presented in
Table~\ref{tab:agda-metis-table} using the pattern present in the
example above.  We follow the same order to present the rules as the
table shows.


% -----------------------------------------------------------------------------

\subfile{sections/proof-reconstruction/strip.tex}
\subfile{sections/proof-reconstruction/conjunct.tex}
\subfile{sections/proof-reconstruction/resolve.tex}
\subfile{sections/proof-reconstruction/canonicalize.tex}
\subfile{sections/proof-reconstruction/clausify.tex}
\subfile{sections/proof-reconstruction/simplify.tex}

%------------------------------------------------------------------------------

We have finished the formalization of every inference rule in
a \Metis proof, we are able to justify step-by-step any proof
for a problem in propositional logic.
For instance, we tested successfully the translation by \Athena jointly with
the \Agda formalizations of the rules mentioned above with more than eighty
representative theorems in propositional logic. An interested reader can test
the problems~\cite{Prieto-Cubides2017} in the \Athena tool
repository~\cite{Athena}.

\end{document}
