
\documentclass[../main.tex]{subfiles}
\begin{document}

% ===================================================================

\section{Proof-Reconstruction}
\label{sec:proof-reconstruction}

The proof-reconstruction approach proposed consists of a series
of steps similar to the workflow presented by \citeauthor{sultana2015} in
\cite{sultana2015}. This process is a translation from a source
system to a target system. In our case, the system of origin, the
automatic theorem prover, is \Metis; the target system is a proof
assistant, \Agda. We choose \Agda, but another proof assistant with the
same support of type theory and inductive types could be used.

\subsection{Workflow}
\label{ssec:workflow}

\input{sections/diagram.tex}
%  (see a description of \Agda for its main features in
% Section~\ref{sec:implementation}).
The overview of the proof-reconstruction is presented in
Fig.~\ref{fig:proof-reconstruction-workflow}. The process begin with
a \TPTP file that encodes a problem in \CPL. We use this file as the
input of the \Metis prover. If the problem is a theorem, \Metis
reply a derivation of the proof in \TSTP format.

With the \TSTP derivation from Step~2, we process the derivation with the
\Athena translator tool.
\Athena parses the \TSTP format, analyzes the
derivation and generates a representation of the natural deduction
proof using a tree data structure (see the properties
of this tree in Section~\ref{ssec:metis-proofs}).
In the \Athena analysis, some unnecessary steps that introduce redundancies
and some unused input is removed from the proof-tree.
As result, we get from \Athena an \Agda file of the proof
with names of functions and theorems from
the \Agda libraries that accompany this article:
\texttt{agda-prop} and \texttt{agda-metis}.

Finally, we type-check the \Agda proof-term. If the type-checking
success, the \TSTP derivation delivered by \Metis is correct
module \Agda and the proposed formalizations for the
propositional logic and the \Metis inferences.
In that case \Agda outputs an interface file.
Otherwise, when type-checking fails, the failure must be
investigated by the user looking at the error in the \TSTP derivation
by \Metis, in the translation by \Athena, in the \Agda formalizations
mentioned above or in the type-checker~\Agda.

In the remainder part of this section, a formal description using
type theory is presented to build definitions and theorems of
functions necessary to emulate \Metis' inference rules.

% % ................................................

\subsection{Reconstructing \Metis' inference rules}
\label{ssec:emulating-inferences}

In this section, we reconstruct each \Metis inference rule with a
function and its respective theorem. We present a pattern of the
formal description for these rules.

\begin{notation}
The function name written in bold font is a \Metis inference rule.
The same function name written in roman letters refers to the proposed
version of the rule.
Each rule proposed has a respective theorem also written in roman letters
that proves its soundness.
\end{notation}

\begin{myexample}
\Metis has a inference rule named conjunct.
We refer to this rule writing \conjunct.

\begin{verbatim}
fof(p3, (r | ~ p), inf(conjunct, [p1])).
\end{verbatim}

The pattern of the formalization for this rule is the following.
For \conjunct rule, we define in type theory a function using the same name,
conjunct, but written using roman font to distinguish from the original.
The \fconjunct function has the following pattern:

 \begin{equation*}
  \begin{aligned}
  &\hspace{.495mm}\fconjunct : \Prop → \Prop → \Prop\\
  &\begin{array}{ll}
  \fconjunct~φ~ψ\ &=
      \begin{cases}
      ψ, &\text{if }\fconjunct \text{ built }ψ\text{ by applying valid}\\
         &\text{transformations or other rules to }φ\\
      φ, &\text{otherwise.}
      \end{cases}
  \end{array}
  \end{aligned}
  \end{equation*}

\begin{itemize}
  \item[$\bullet$] $φ$ is the \emph{source} formula from a previous deducted derivation.
  \item[$\bullet$] $ψ$ is the \emph{target} formula. The expected result of \texttt{rule}.
\end{itemize}

To justify all transformations done by \fconjunct, we prove its soundness
with a theorem. This theorem would be

\begin{equation*}
\text{If }Γ ⊢ φ\text{ then }Γ ⊢ \fconjunct~φ~ψ.
\end{equation*}

\end{myexample}

The remainder of this section will be devoted to present a formal description
in type theory of each rule presented in Table~\ref{tab:agda-metis-table} using
the pattern present in the example above.

% -----------------------------------------------------------------------------

\subfile{sections/proof-reconstruction/strip.tex}
\subfile{sections/proof-reconstruction/conjunct.tex}
\subfile{sections/proof-reconstruction/resolve.tex}
\subfile{sections/proof-reconstruction/canonicalize.tex}
\subfile{sections/proof-reconstruction/clausify.tex}
\subfile{sections/proof-reconstruction/simplify.tex}

%------------------------------------------------------------------------------

Now, we have finished the formalization of every inference rule in
a \Metis proof, we are able to justify step-by-step any proof
for a problem in propositional logic.
For instance, we tested successfully the translation by \Athena jointly with
the \Agda formalizations of the rules mentioned above with more than eighty
representative theorems in propositional logic. An interested reader can test
the problems~\cite{Prieto-Cubides2017} in the \Athena tool
repository~\cite{Athena}.

\end{document}
